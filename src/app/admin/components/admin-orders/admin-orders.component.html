<app-admin-navbar></app-admin-navbar>
<div class="container-fluid">
  <h2>Customer Orders</h2>

  <div *ngIf="ordersList.length === 0" class="alert alert-info">
    No orders found.
  </div>

  <ng-container *ngFor="let order of ordersList; let i = index">
    <div class="card mb-4 order-card">

      <div class="d-flex justify-content-between align-items-center">
        <div>
          <strong>Order #{{ order.id }}</strong>
          <br>
          <strong>User :{{ order.userId }}</strong>
          <br>
          <small class="text-muted">Ordered on: {{ order.createdAt?.toDate() | date: 'medium' }}</small>
          <br>
        </div>

        <div>
          <div>Order Total: {{ order.total | currency: 'INR' }}</div>
          <small>{{ order.status }}</small>
          <br>
          <button
            class="btn btn-sm btn-primary mt-3"
            *ngIf="getNextStatus(order.status)"
            (click)="changeStatus(order, getNextStatus(order.status)!)">
            Move to {{ getNextStatus(order.status) }}
          </button>

          <span *ngIf="!getNextStatus(order.status)">Done</span>
          <br>
          <!-- Unique collapse ID using order.id -->
          <button class="btn btn-sm btn-primary mt-3"
                  type="button"
                  (click)="toggleShowMore(order.id)"
                  [attr.aria-expanded]="expandedOrders[order.id] || false"
                  [attr.aria-controls]="'collapse' + order.id">
            {{ expandedOrders[order.id] ? 'Hide Order Details' : 'Show Order Details' }}
          </button>
        </div>
      </div>

      <!-- Collapse section with unique ID -->
      <div [id]="'collapse' + order.id"
           class="collapse"
           [class.show]="expandedOrders[order.id]">
        <div class="card-body">
          <div *ngFor="let item of order.items" class="mb-3 pb-2">
            <div class="row">
              <div class="col-8">
                <div class="font-weight-bold">{{ item.name }}
                </div>
              </div>
              <div class="col-4 text-right">
                <div class="text-muted">
                  {{ item.quantity }} N x {{ item.price }} =
                  {{ item.price * item.quantity | currency: 'INR' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>


